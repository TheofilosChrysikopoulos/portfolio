<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <!-- Prevent iOS text auto-zoom and allow proper responsive sizing -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <link rel="icon" href="../../assets/controllerLogo2.png" type="image/png">
  <title>Portal Simulation • Web Demo</title>

  <link rel="stylesheet" href="../../style.css">
  <script defer src="../../script.js"></script>

  <style>
    :root {
      --bg: #0b0d12;
      --fg: #e8ecf1;
      --muted: #a4afbf;
      --card: #12161f;
      --line: #1e2633;
      --brand: #6cf0ff;
      --accent: #7df1a8;
    }

    html, body { height: 100%; }
    html { -webkit-text-size-adjust: 100%; } /* stop iOS from auto-enlarging text */
    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, sans-serif;
      overflow-x: hidden; /* guard against accidental horizontal scroll */
    }

    .project-page { max-width: 1100px; margin: 0 auto; padding: 24px; }
    .topbar { display: flex; gap: 12px; align-items: center; justify-content: space-between; margin-bottom: 16px; }
    .topbar a { text-decoration: none; color: var(--fg); opacity: .9; }

    .btn {
      display: inline-flex; align-items: center; gap: .5rem;
      background: var(--card); border: 1px solid var(--line);
      border-radius: 12px; padding: 10px 14px;
      color: var(--fg); text-decoration: none; cursor: pointer;
      transition: transform .06s ease, border-color .2s ease;
      white-space: nowrap;
    }
    .btn:hover { border-color: var(--brand); transform: translateY(-1px); }
    .btn.primary { background: linear-gradient(180deg, #162233, #121a28); border-color: #20324a; }

    h1 { font-size: clamp(28px, 4vw, 40px); line-height: 1.1; margin: 6px 0 8px; letter-spacing: .3px; }
    .subtitle { color: var(--muted); margin: 0 0 18px; }

    .taglist { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0 0; }
    .tag { font-size: 12px; padding: 6px 10px; border: 1px solid var(--line); color: var(--muted); border-radius: 999px; background: #0f1420; }

    .hero { background: var(--card); border: 1px solid var(--line); border-radius: 16px; padding: 18px; }

    .grid { display: grid; gap: 16px; }
    .two { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .three { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    @media (max-width: 900px) { .two, .three { grid-template-columns: 1fr; } }

    .card { background: var(--card); border: 1px solid var(--line); border-radius: 16px; padding: 18px; }
    .card img, .card video { width: 100%; border-radius: 12px; display: block; }
    .section-title { font-size: 20px; margin: 4px 0 12px; }
    .footer { margin: 32px 0 12px; color: var(--muted); font-size: 14px; text-align: center; }

    .hero, section.card, .footer { margin: 0; }
    .hero + section.card, section.card + section.card, section.card + .footer {
      margin-top: clamp(18px, 3vw, 40px);
    }
    .project-page .hero { margin-top: clamp(8px, 1vw, 16px); }

    /* === Responsive Game Stage (4:3, fits phones) === */
    .stage-wrap { margin: 12px 0 10px; display: grid; place-items: center; }
    .stage {
      width: 100%;
      /* Typical Emscripten builds target 1024x768 -> 4:3; keep that shape responsively */
      aspect-ratio: 4 / 3;
      max-height: 90vh;            /* don’t exceed the viewport height on phones */
      background: #000;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
      position: relative;
      overflow: hidden;
      border: 1px solid var(--line);
    }
    .stage iframe {
      position: absolute; inset: 0;
      width: 100%; height: 100%;
      border: 0; background: #000;
      display: block;
    }

    .overlay {
      pointer-events: none; position: absolute; inset: 0;
      display: grid; place-items: center; color: #fff;
      text-shadow: 0 2px 12px rgba(0,0,0,.6);
      background: linear-gradient(to bottom, rgba(0,0,0,.15), rgba(0,0,0,.25));
      font-weight: 700; letter-spacing: .2px;
      opacity: .9; transition: opacity .15s ease;
      text-align: center;
      padding: 10px;
    }
    .overlay.hidden { opacity: 0; pointer-events: none; }
    .info { margin-top: 8px; color: var(--muted); font-size: 14px; text-align: center; }

    .kbd {
      font: 600 12px/1 ui-monospace, SFMono-Regular, Consolas, monospace;
      padding: 3px 6px; border-radius: 6px;
      border: 1px solid #263345; background: #111826; color: #cfe1ff;
      display: inline-block; margin-right: 4px;
    }

    /* === Toolbars below the demo; wrap and clamp on phones === */
    .demo-toolbar {
      display: flex; gap: 8px; align-items: center;
      padding: 10px 12px; border-top: 1px solid var(--line); background: #0f1420;
      border-radius: 12px; margin-top: 10px;
      justify-content: space-between;
      flex-wrap: wrap;               /* allow wrapping on narrow screens */
    }
    .demo-toolbar p, .demo-toolbar span {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
      max-width: 100%;
      overflow-wrap: anywhere;       /* stop long tokens from overflowing */
      line-height: 1.35;
    }
    .demo-toolbar .btn-group {
      display: flex; gap: 8px; flex: 0 1 auto;
    }

    @media (max-width: 560px) {
      .demo-toolbar { justify-content: center; }
      .demo-toolbar .btn-group {
        order: 1; width: 100%; justify-content: center;
      }
      .demo-toolbar p, .demo-toolbar span {
        order: 2; flex: 1 1 100%; text-align: center; font-size: 13px;
      }
      .btn { padding: 8px 10px; font-size: 14px; }
    }
  </style>
</head>
<body>
  <main class="project-page">
    <!-- Top bar -->
    <div class="topbar">
      <div style="display:flex; gap:8px; align-items:center;">
        <a class="btn" href="../../">← Back to Portfolio</a>
      </div>
      <div style="display:flex; gap:8px;">
        <a class="btn primary" href="#about">About</a>
      </div>
    </div>

    <!-- Hero -->
    <header class="hero">
      <h1>Portal Simulation</h1>
      <p class="subtitle">C++/OpenGL prototype (WebGL2 via Emscripten). Tap/click to play — pointer lock and fullscreen supported.</p>
      <div class="taglist">
        <span class="tag">OpenGL</span><span class="tag">C++</span><span class="tag">GLSL</span><span class="tag">WebGL2</span>
      </div>
    </header>

    <!-- Demo -->
    <section class="card" id="demo">
      <div class="stage-wrap">
        <div class="stage" id="stage">
          <iframe
            id="gameframe"
            src="app/index.html"
            title="Portal Simulation"
            loading="eager"
            fetchpriority="high"
            allow="fullscreen; gamepad; pointer-lock; keyboard-map; xr-spatial-tracking"
            allowfullscreen
          ></iframe>
          <div class="overlay" id="overlay">
            <div>
              <div>Tap to play</div>
              <div class="info" style="margin-top:6px; font-weight:400;">
                Tip: On phones, you cannot play this.
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Toolbar(s) below the demo -->
      <div class="demo-toolbar">
        <span>Controls:
          <span class="kbd">W</span><span class="kbd">A</span><span class="kbd">S</span><span class="kbd">D</span> move,
          <span class="kbd">Mouse</span> look,
          <span class="kbd">L click</span> blue portal / pick up,
          <span class="kbd">R click</span> purple portal / throw,
          <span class="kbd">Space</span> jump, <span class="kbd">C</span> colliders on/off.
        </span>
        <div class="btn-group">
          <button class="btn" id="btnFullscreen" type="button">Fullscreen</button>
        </div>
      </div>
    </section>

    <!-- About -->
    <section class="card" id="about">
      <h2 class="section-title">About this project</h2>
      <p>
        I built this project for my 4th-year university course <strong>3D Graphics and Virtual Reality</strong>. 
        The goal was to simulate a <strong>portal system</strong> inspired by the game <em>Portal</em>, featuring both the visual portal effect and basic physics 
        that allow the player to walk and throw objects through the portals.
      </p>

      <p>
        Beyond implementing the core requirements, I added a <strong>ray-casting system</strong> that lets the user place portals only on surfaces large enough to fit them. 
        I also built a <strong>portal gun mechanic</strong> that enables grabbing and moving cubes around, similar to the original game. 
        To support realistic interactions, I created a full <strong>collision detection and physics simulation system</strong> for rectangular boxes of arbitrary scale, 
        so that both the player and objects could interact naturally with the environment.
      </p>

      <p>
        All geometry, colliders, and physics behaviors were implemented from scratch. I wrote custom model loaders to import assets into the OpenGL environment, 
        built object and collider classes, and implemented the entire shader pipeline—from basic lighting to the visual portal effect—using GLSL. 
        Every effect, including reflections and lighting, was coded manually without the use of any external rendering frameworks.
      </p>

      <h4>What I learned</h4>
      <p>
        This project was my introduction to <strong>shaders</strong> and the inner workings of the graphics pipeline. 
        I learned how the CPU communicates with the GPU and implemented fundamental shading algorithms such as Phong lighting. 
        For an early graphics project, it turned out remarkably well—aside from a few small bugs (like imperfect collider shapes)—and earned me a 10/10 grade for the course.
      </p>

      <p><em>Note: This project was later ported to WebGL using Emscripten.</em></p>

      <div class="grid two" style="margin-top:10px;">
        <div>
          <h3 class="section-title">Highlights</h3>
          <ul>
            <li>Blinn-Phong Shading</li>
            <li>Portal visual effect shaders</li>
            <li>Simple physics</li>
            <li>Arbitrary scale box collision detection</li>
          </ul>
        </div>
        <div>
          <h3 class="section-title">Tech</h3>
          <ul>
            <li>OpenGL</li>
            <li>GLSL</li>
            <li>C++</li>
          </ul>
        </div>
      </div>
    </section>

    <p class="footer">© Theofilos Chrysikopoulos — <a href="../../">Back to portfolio</a></p>
  </main>

  <!-- Minimal logic: keep game confined, pointer lock/fullscreen UX, tidy iframe -->
  <script>
    (function () {
      const stage   = document.getElementById('stage');
      const frame   = document.getElementById('gameframe');
      const overlay = document.getElementById('overlay');
      const btnFS   = document.getElementById('btnFullscreen');

      function getInner() {
        const w = frame.contentWindow;
        if (!w) return {};
        const doc = w.document;
        const Module = w.Module || {};
        // Common Emscripten canvas handles
        const canvas = Module.canvas || (doc && (doc.getElementById('canvas') || doc.querySelector('canvas')));
        return { w, doc, Module, canvas };
      }

      function hideOverlay(){ overlay.classList.add('hidden'); }
      function showOverlay(){ overlay.classList.remove('hidden'); }

      // Inject CSS into the emscripten page to remove default chrome and prevent scrollbars
      function prepareInnerDocument() {
        const { doc, canvas } = getInner();
        if (!doc) return;

        const hideCSS = doc.createElement('style');
        hideCSS.textContent = `
          #status, #controls, #output, #emscripten_logo { display:none !important; }
          html, body { margin:0!important; padding:0!important; height:100%; overflow:hidden!important; }
          canvas { display:block; outline:none; width:100% !important; height:100% !important; }
        `;
        doc.head.appendChild(hideCSS);

        // Pointer lock UX
        if (canvas) {
          canvas.setAttribute('tabindex', '0');
          canvas.addEventListener('mousedown', () => {
            try { canvas.focus(); } catch(e) {}
            if (canvas.requestPointerLock) { try { canvas.requestPointerLock(); } catch(e) {} }
            hideOverlay();
          });

          doc.addEventListener('pointerlockchange', () => {
            const locked = doc.pointerLockElement === canvas;
            if (locked) hideOverlay(); else showOverlay();
          });
        }
      }

      function engage() {
        const { canvas } = getInner();
        if (!canvas) return;
        try { canvas.focus(); } catch(e) {}
        if (canvas.requestPointerLock) { try { canvas.requestPointerLock(); } catch(e) {} }
        hideOverlay();
      }

      async function enterFullscreen() {
        const { canvas } = getInner();
        const target = canvas || frame;
        if (!target) return;
        const req = target.requestFullscreen || target.webkitRequestFullscreen;
        if (req) { try { await req.call(target); } catch(e) {} }
        try { target.focus(); } catch(e) {}
        if (canvas && canvas.requestPointerLock) { try { canvas.requestPointerLock(); } catch(e) {} }
        hideOverlay();
      }

      // Keep overlay hint in sync with pointer lock state
      function wireParentPointerLockSync() {
        const { doc, canvas } = getInner();
        if (!doc || !canvas) return;
        doc.addEventListener('pointerlockchange', () => {
          const locked = doc.pointerLockElement === canvas;
          if (locked) hideOverlay(); else showOverlay();
        });
      }

      // Clicking the stage engages the game on both desktop & mobile
      stage.addEventListener('click', engage);

      // When the iframe loads, tidy its internal layout
      frame.addEventListener('load', () => {
        // small delay to ensure Emscripten has attached its DOM
        setTimeout(() => {
          prepareInnerDocument();
          wireParentPointerLockSync();
        }, 60);
      });

      btnFS.addEventListener('click', enterFullscreen);
    })();
  </script>
</body>
</html>
